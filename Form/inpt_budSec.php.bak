<script>

	function open_child(url,title,w,h){
		var left = (screen.width/2)-(w/2);
		var top = (screen.height/2)-(h/2);
		w = window.open(url, title, 'toolbar=no, location=no, directories=no, \n\
			status=no, menubar=no, scrollbar=no, resizabel=no, copyhistory=no,\n\
			width='+w+',height='+h+',top='+top+',left='+left);
		
	};	
	function cr_nm(url,title,w,h){
		var nik=document.form1.account.value;
		var left = (screen.width/2)-(w/2);
		var top = (screen.height/2)-(h/2);
		w = window.open(url+'&ac='+nik, title, 'toolbar=no, location=no, directories=no, \n\
			status=no, menubar=no, scrollbar=no, resizabel=no, copyhistory=no,\n\
			width='+w+',height='+h+',top='+top+',left='+left);		
	};
	function cr_part(url,title,w,h){
		var pno=document.form1.part_no.value;
		var pnd=document.form1.part_nm.value;
		var peri=document.form1.periode.value;
		var lp=document.form1.lp.value;
		var left = (screen.width/2)-(w/2);
		var top = (screen.height/2)-(h/2);
		w = window.open(url+'&pno='+pno+'&pnd='+pnd+'&p='+peri+'&lp='+lp, title, 'toolbar=no, location=no, directories=no, \n\
			status=no, menubar=no, scrollbar=no, resizabel=no, copyhistory=no,\n\
			width='+w+',height='+h+',top='+top+',left='+left);		
	};

	function cr_curr(url,title,w,h){
		var price=document.form1.price.value;
		var curr=document.form1.curr.value;
		var term=document.form1.term.value;
		var left = (screen.width/2)-(w/2);
		var top = (screen.height/2)-(h/2);
		w = window.open(url+'&price='+price+'&curr='+curr+'&term='+term, title, 'toolbar=no, location=no, directories=no, \n\
			status=no, menubar=no, scrollbar=no, resizabel=no, copyhistory=no,\n\
			width='+w+',height='+h+',top='+top+',left='+left);		
	};

	function cr_ctrl(url,title,w,h){
		var pno=document.form1.term.value;
		var pnd=document.form1.periode.value;
		var jns_bud=document.form1.jns_bud.value;
		var pernow = new Date();
		var nperi=pernow.getFullYear()+''+("0"+(pernow.getMonth()+1)).slice(-2);
		var balp=parseInt(pnd)-parseInt(nperi);
	 // alert(balp);
	 if(pno=="" || balp<0){alert("Term Belum dipilih Atau Periode Kurang dari tanggal Sekarang");}else{
	 	var left = (screen.width/2)-(w/2);
	 	var top = (screen.height/2)-(h/2);
	 	w = window.open(url+'&t='+pno+'&p='+pnd+'&k='+jns_bud, title, 'toolbar=no, location=no, directories=no, \n\
	 		status=no, menubar=no, scrollbar=no, resizabel=no, copyhistory=no,\n\
	 		width='+w+',height='+h+',top='+top+',left='+left);	
	 }
	};


</script>
<?php 
$sect= $_SESSION["area"];
$pic_updt=$_SESSION['nama'];
?>
<section class="content">
	<div class="container-fluid">
		<div class="block-header">
			<h2>BUDGET SECTION <?php echo strtoupper($sect); ?></h2>
		</div>
		<div class="row clearfix">
			<div class="col-lg-9 col-md-9 col-sm-12 col-xs-12">
				<div class="card">
					<div class="header">
						<h2>Change Data Budget</h2>
					</div>
					<div class="body">
						<form role="form"  name="form1" id="form1" method="post" class="step_with_validation" action="">
							<h3>STEP 1</h3>
							<fieldset>
								<div class="col-sm-3">
									<div class="form-group">
										<label>Term</label>
										<div class="input-group">
											<div class="form-line">
												<input type="text" readonly class="form-control bg-grey" id="term" name="term" placeholder="term" required>
											</div>
										</div>
									</div>
									<div class="form-group">
										<label>Periode</label>
										<div class="form-line">
											<input type="text" readonly class="form-control bg-grey" id="periode" name="periode" placeholder="periode" required>			               
										</div>
									</div>
								</div>
								<div class="col-sm-3"> 
									<div class="form-group">
										<label>Type</label>
										<div class="input-group">
											<input type="text" readonly class="form-control bg-grey" id="jns_bud" name="jns_bud" placeholder="Type" required>
										</div>
									</div>
									<div class="form-group">
										<label>Control No</label>
										<div class="input-group">
											<div class="form-line">
												<input type="text" readonly class="form-control bg-grey" id="no_ctrl" name="no_ctrl" placeholder="No Control" required>
											</div>
											<span class="input-group-addon">
												<button type="button" class="btn bg-red waves-effect"  onclick="cr_ctrl('template.php?plh=select/plh_crctrl.php&s=<?php echo $sect; ?>','Data Conveyor','800','500'); return false;"><i class="material-icons">search</i> </button>
											</span>
										</div> 
									</div>
								</div>
								<div class="col-sm-3"> 
									<div class="form-group">
										<label>Cost Center</label>
										<div class="input-group">
											<div class="form-line">
												<input type="text" class="form-control bg-grey" id="cccode" name="cccode" placeholder="Cost Center" required readonly>
											</div>
											<span class="input-group-addon">
												<button type="button" class="btn bg-purple waves-effect"  onclick="open_child('template.php?plh=select/plh_cccode_budsec.php&o=cccode&k=1','Data Conveyor','800','500'); return false;"><i class="material-icons">search</i> </button>
											</span>
										</div>
									</div>
									<div class="form-group">
										<label>Process Code</label>
										<div class="input-group">
											<div class="form-line">
												<input type="text" class="form-control" id="id_proses" name="id_proses" placeholder="Kode Proses" required>
											</div> <span class="input-group-addon">
												<button type="button" class="btn bg-purple waves-effect"  onclick="open_child('template.php?plh=select/plh_pros.php','Data Conveyor','800','500'); return false;"><i class="material-icons">search</i> </button>
											</span>
										</div>
									</div>
								</div>

								<div class="col-sm-3"> 
									<div class="form-group">
										<label>Purchasing</label>
										<div class="input-group">
											<select class="selectpicker" style="width: 100%;"  name="lp" id="lp" placeholder="Choose Purchasing" required>
												<option selected="selected" value="">-Choose Purchasing-</option>
												<?php
												$qlp="select * from bps_lp order by kd_lp";
												$tb_lp=odbc_exec($koneksi_lp,$qlp);
												while($bar_qlp=odbc_fetch_array($tb_lp)){
													$dt_lp=odbc_result($tb_lp,"kd_lp");
													echo '<option value="'.$dt_lp.'">'.$dt_lp.'</option>';
												}				
												?>
											</select>
										</div>
									</div>
								</div>

							</fieldset>
							<h3>STEP 2</h3>
							<fieldset>
								<div class="col-sm-4">	
									<div class="form-group">
										<label>Part No</label>
										<div class="input-group">
											<div class="form-line">
												<input type="text" class="form-control" id="part_no" name="part_no" placeholder="Part No" required>
											</div>
											<span class="input-group-addon">
												<button type="button" class="btn bg-purple waves-effect"  onclick="cr_part('template.php?plh=select/plh_partsec.php','Data Conveyor','800','500'); return false;"><i class="material-icons">search</i> </button>
											</span>
										</div>
									</div>
									<div class="form-group">
										<label>Part Name</label>
										<div class="form-line">
											<input type="text" class="form-control bg-grey" id="part_nm" name="part_nm" placeholder="Nama Part" required>
										</div>
									</div>
								</div>
								<div class="col-sm-8">
									<div class="form-group">
										<label>Part Detail</label>
										<div class="form-line">
											<input type="text"  readonly class="form-control bg-grey" id="part_dtl" name="part_dtl" placeholder="Detail Part" >
										</div>
									</div>
									<div class="form-group">
										<label>Part Deskripsi</label>
										<div class="form-line">
											<input type="text" class="form-control" id="part_desc" name="part_desc" placeholder="Deskripsi" >
										</div>
									</div>
								</div>

							</fieldset> 
							<h3>STEP 3</h3>
							<fieldset>
								<div class="col-sm-4">
									<div class="form-group">
										<label>Qty</label>
										<div class="form-line">
											<input type="number" readonly class="form-control bg-grey" id="qty" name="qty" placeholder="Qty" required>
										</div>
									</div>
									<div class="form-group">
										<label>UOM</label>
										<div class="form-line">
											<input type="text" class="form-control" id="uom" name="uom" placeholder="Uom" required>
										</div>
									</div>
								</div>
								<div class="col-sm-4"> 
									<div class="form-group">
										<label>Currency</label>
										<div class="input-group">
											<div class="form-line">
												<input type="text" readonly class="form-control" id="curr" name="curr" placeholder="curr" required>
											</div>
											<span class="input-group-addon">
												<button type="button" class="btn bg-purple waves-effect"  onclick="cr_curr('template.php?plh=select/plh_curr.php&o=cccode&k=1','Data Conveyor','800','500'); return false;"><i class="material-icons">search</i> </button>
											</span>
										</div>
									</div>

									<div class="form-group">
										<label>Price</label>
										<div class="form-line">
											<input type="text" class="form-control bg-grey" id="price" name="price" placeholder="price" required readonly>
										</div>
									</div>

								</div>
								<div class="col-sm-4">
									<div class="form-group">
										<label>Phase</label>
										<div class="input-group">
											<select class="selectpicker" style="width: 100%;"  name="phase" id="phase"  required>
												<option selected="selected" value="">-Choose Phase-</option>
												<?php
												$qphase="select distinct phase from bps_phase";
												$tb_phase=odbc_exec($koneksi_lp,$qphase);
												while($bar_qphase=odbc_fetch_array($tb_phase)){
													$dt_phase=odbc_result($tb_phase,"phase");
													echo '<option value="'.$dt_phase.'">'.$dt_phase.'</option>';
												}				
												?>
											</select>
										</div>
									</div>
								</div>
							</fieldset>
							<h3>FINISH</h3>
							<fieldset>
								<div class="col-sm-4">
									<div class="form-group">
										<label>LT Quotation</label>
										<div class="form-line">
											<input type="number" class="form-control" id="lt_Quo" name="lt_Quo" placeholder="LT Quotation" required>
										</div>
									</div>
									<div class="form-group">
										<label>LT PR</label>
										<div class="form-line">
											<input type="number" class="form-control" id="lt_pr" name="lt_pr" placeholder="LT PR" required>
										</div>
									</div>
								</div>
								<div class="col-sm-4"> 
									<div class="form-group">
										<label>LT PO</label>
										<div class="form-line">
											<input type="number" class="form-control" id="lt_po" name="lt_po" placeholder="LT PO" required>
										</div>
									</div>
									<div class="form-group">
										<label>LT Arrival</label>
										<div class="form-line">
											<input type="number" class="form-control" id="lt_datang" name="lt_datang" placeholder="LT Arrival" required>
										</div>
									</div>
								</div>
								<div class="col-sm-4"> 
									<div class="form-group">
										<label>LT VP</label>
										<div class="form-line">
											<input type="number" class="form-control" id="lt_vp" name="lt_vp" placeholder="LT VP" required>
										</div>
									</div>
									<button type="submit" id="smpn_acc" name="smpn" class="btn bg-green waves-effect"><i class="material-icons">saves</i>SIMPAN</button>		 
									<button type="reset" id="reset" name="reset" class="btn bg-red waves-effect"><i class="material-icons">delete</i>Clear</button>	
								</div>
							</fieldset>
						</form>
					</div>
				</div>
			</div>
			<?php
			if(isset($_POST['smpn']) or isset($_POST['del'])){	
				$term=$_POST['term'];
				$jns_budget="NORMAL";
				
				$no_ctrl=$_POST['no_ctrl'];
				$lp=$_POST['lp'];
				$id_proses=$_POST['id_proses'];
				$part_nm=$_POST['part_nm'];
				$part_no=$_POST['part_no'];
				$part_desc=$_POST['part_desc'];
				$part_dtl=$_POST['part_dtl'];
				$periode=$_POST['periode'];
				$cccode=$_POST['cccode'];
				$phase=$_POST['phase'];
				$qty=$_POST['qty'];
				$uom=$_POST['uom'];
				$price=$_POST['price'];
				$curr=$_POST['curr'];
				$lt_vp=$_POST['lt_vp'];
				$lt_datang=$_POST['lt_datang'];
				$lt_po=$_POST['lt_po'];
				$lt_pr=$_POST['lt_pr'];
				$lt_Quo=$_POST['lt_Quo'];
				$tot_lt=$lt_vp+$lt_datang+$lt_po+$lt_pr+$lt_Quo;
				if ($tot_lt==0) {
					$expaired=date("Y-m-t",strtotime($periode."28"));
				}else {
					$expaired=date("Y-m-d",strtotime($periode."28"));
				}

				$jns_bud=$_POST['jns_bud'];

				if($jns_bud=='NORMAL'){
					$qry_chg="update bps_budget set price=$price, part_no='$part_no',part_nm='$part_nm',part_dtl='$part_dtl',part_desc='$part_desc',lp='$lp',uom='$uom',id_proses='$id_proses',curr='$curr',cccode='$cccode',phase='$phase',lt_Quo='$lt_Quo',lt_pr='$lt_pr',lt_po='$lt_po',lt_datang='$lt_datang',lt_vp='$lt_vp',expaired='$expaired',pic_updt='$pic_updt',tgl_updt=getdate() where no_ctrl='$no_ctrl'";
				} else
				{
					$qry_chg="update bps_budget_add set price=$price,curr='$curr',part_no='$part_no',part_nm='$part_nm',part_dtl='$part_dtl',part_desc='$part_desc',lp='$lp',uom='$uom',id_proses='$id_proses',cccode='$cccode',phase='$phase',lt_Quo='$lt_Quo',lt_pr='$lt_pr',lt_po='$lt_po',lt_datang='$lt_datang',lt_vp='$lt_vp',expaired='$expaired',pic_updt='$pic_updt',tgl_updt=getdate() where no_ctrl='$no_ctrl'";
				}
				// ECHO $qry_chg;

				if(isset($_POST['smpn']) ){	
					$tb_add=odbc_exec($koneksi_lp,$qry_chg);
					echo "<script>alert('DATA SUDAH DI UPDATE');</script>";
					$sq_acc="select sect, term, jns_budget, no_ctrl, lp, id_proses, account, sub_acc, part_no, part_nm, part_dtl, periode, qty, uom, curr, price, phase,cccode,expaired,lt_Quo,lt_pr,lt_po,lt_datang,lt_vp from bps_budget where sect='$sect' and no_ctrl='$no_ctrl'
					UNION
					select sect, term, jns_budget, no_ctrl, lp, id_proses, account, sub_acc, part_no, part_nm, part_dtl, periode, qty, uom, curr, price, phase, cccode,expaired,lt_Quo,lt_pr,lt_po,lt_datang,lt_vp from bps_budget_add where sect='$sect' and no_ctrl='$no_ctrl' and kode_chg in (5) ";
				}
			}
			?>	 
			<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
				<div class="card">
					<div class="header">
						<h2>UPLOAD<small>Upload Revisi Budget Section</small></h2>
					</div>
					<div class="body">
						<form role="form" enctype="multipart/form-data" name="form2" id="form2" method="post" action="">
							<div class="row clearfix">
								<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
									<div class="form-group">
										<label>Open File</label>
										<div class="form-line">
											<input type="file" class="form-control" id="file" name="file" placeholder="Cari File" required>
										</div>
									</div>
									<button type="submit" id="upld" name="upld" class="btn bg-orange waves-effect">
										<i class="material-icons">file_upload</i>Upload Data
									</div>
									<?php									
									if(isset($_POST['upld']) )
									{
										require_once "excel_reader2.php";
									// echo "<script>alert('upload data');</script>"; 								
									$file_name = $_FILES['file']['name'];// nama file (tanpa path)								
									$tmp_name  = $_FILES['file']['tmp_name']; //nama local temp file di server								
									$file_size = $_FILES['file']['size']; //ukuran file (dalam bytes)								
									$file_type = $_FILES['file']['type']; //tipe filenya (langsung detect MIMEnya)		
									$fp1 = fopen($tmp_name, 'r'); // open file (read-only, binary)
									$fp = fopen($tmp_name, 'r');		
									$pecah=explode(".",$file_name);
									$ekstensi=$pecah[1];
									$extensionList=array("xls","XLS");
									if(in_array($ekstensi,$extensionList))
									{
										$target = basename($_FILES['file']['name']) ;
										move_uploaded_file($_FILES['file']['tmp_name'], $target);			 
										$data = new Spreadsheet_Excel_Reader($_FILES['file']['name'],false);  
										$baris = $data->rowcount($sheet_index=0);
										$fixedbaris = $baris;
										$section=$data->val(2,2);
										$baris_data=$fixedbaris-7;

										$list_no_ctrl="";
										for ($i=8; $i<=$fixedbaris; $i++)
										{
											$kol1=$data->val($i,1);  // no
											$kol2=$data->val($i,2);  // term
											$kol3=$data->val($i,3);  // jns_budget
											$kol4=$data->val($i,4);  // no_ctrl
											$kol5=$data->val($i,5);  // lp
											$kol6=$data->val($i,6);  // id_proses
											$kol7=$data->val($i,7);  // part_no
											$kol8=$data->val($i,8);  // part_nm
											$kol9=$data->val($i,9);  // part_dtl
											$kol10=$data->val($i,10);  // part_desc
											$kol11=$data->val($i,11);  // periode
											$kol12=str_replace(",","",$data->val($i,12));  // qty
											$kol13=$data->val($i,13);  // uom
											$kol14=$data->val($i,14);  // curr
											$kol15=str_replace(",","",$data->val($i,15));  // price
											$kol16=$data->val($i,16);  // phase
											$kol17=$data->val($i,17);  // cccode
											$kol18=$data->val($i,18);  // lt_Quo
											$kol19=$data->val($i,19);  // lt_pr
											$kol20=$data->val($i,20);  // lt_po
											$kol21=$data->val($i,21);  // lt_datang
											$kol22=$data->val($i,22);  // lt_vp
											$list_no_ctrl=$list_no_ctrl.",".'$kol4';

											$cr_part=odbc_exec($koneksi_lp, "SELECT top 1 * FROM bps_part WHERE part_no='$kol7' and part_nm='$kol8' order by tgl_updt desc");
											$pno=odbc_result($cr_part, "part_no");
											$pnm=odbc_result($cr_part, "part_nm");
											$pdtl=odbc_result($cr_part, "part_dtl");
											$curr=odbc_result($cr_part, "curr");
											$uom=odbc_result($cr_part, "uom");
											$lp=odbc_result($cr_part, "lp");

											$cr_spt=odbc_exec($koneksi_lp,"select part_no,part_nm,part_dtl,lp,curr,
												price,uom,phase,cccode,dbo.lp_konprc(term,'$kol14',curr,price) 
												as price_convert from bps_budget where no_ctrl='$kol4'");
											$price_convert=odbc_result($cr_spt, "price_convert");
											$part_no_b=odbc_result($cr_spt, "part_no");
											$part_nm_b=odbc_result($cr_spt, "part_nm");
											$part_dtl_b=odbc_result($cr_spt, "part_dtl");
											$lp_b=odbc_result($cr_spt, "lp");
											$curr_b=odbc_result($cr_spt, "curr");
											$price_b=odbc_result($cr_spt, "price");
											$uom_b=odbc_result($cr_spt, "uom");
											$phase_b=odbc_result($cr_spt, "phase");
											$cccode_b=odbc_result($cr_spt, "cccode");
											if($pno==""){$chg_pno="$part_no_b";}else{$chg_pno="$pno";}
											if($pdtl==""){$chg_pdtl="$part_dtl_b";}else{$chg_pdtl="$pdtl";}
											if($uom==""){$chg_uom="$uom_b";}else{$chg_uom="$uom";}
											if($lp==""){$chg_lp="$part_no_b";}else{$chg_lp="$lp";}
											if($pno==""){$chg_pno="$part_no_b";}else{$chg_pno="$pno";}

											if($kol4!="")
											{
												$sql_updt="update bps_budget set lp='$lp',id_proses='$kol6',
												part_no='$chg_pno',part_nm='$kol8',part_dtl='$chg_pdtl',uom='$chg_uom',
												curr='$kol14',price=$price_convert,phase='$kol16',cccode='$kol17',
												lt_Quo=$kol18,lt_pr=$kol19,lt_po=$kol20,lt_datang=$kol21,lt_vp=$kol22,
												pic_updt='$pic_updt',tgl_updt=getdate()
												where no_ctrl='$kol4' ";
												$hasil = odbc_exec($koneksi_lp, $sql_updt);
												// echo "<br>lht ".$i." - ".$sql_updt;
												if(!$hasil)
												{
													echo "<script>alert('Cek part no dengan master part'); window.location = '?page=22002'</script>"; 
													// echo "<br>Error ".$i.$sql_updt." - ".$kol4."<br>";
													print(odbc_error());
												}
											}
										}
										echo "<script>alert('Ada $baris_data baris data berhasil diubah');</script>"; 
										$gab_ctrl=substr($list_no_ctrl, strlen($list_no_ctrl)-1);
										// echo "<br>".$gab_ctrl."<br>";
									}
									else{ echo "<script>alert('Format file harus XLS'); window.location = '?page=22002'</script>"; 
								}
								$sq_acc="select sect, term, jns_budget, no_ctrl, lp, id_proses, account, sub_acc, part_no, part_nm, part_dtl, periode, qty, uom, curr, price, phase,cccode,expaired,lt_Quo,lt_pr,lt_po,lt_datang,lt_vp from bps_budget where sect='$sect' and no_ctrl in ($gab_ctrl)
								UNION
								select sect, term, jns_budget, no_ctrl, lp, id_proses, account, sub_acc, part_no, part_nm, part_dtl, periode, qty, uom, curr, price, phase, cccode,expaired,lt_Quo,lt_pr,lt_po,lt_datang,lt_vp from bps_budget_add where sect='$sect' and no_ctrl in ($gab_ctrl) and kode_chg in (5) ";
								// echo $sq_acc;
							}
							?>
						</div>
					</form>	
				</div>
			</div>
		</div>
	</div>

	<div class="row clearfix">
		<div class="card">
			<div class="row clearfix">				
				<div class="header">
					<h2>Record<small>Cari Plan Budget</small></h2>
				</div>
				<div class="body">
					<form action="" id="frmcari" method="post"  enctype="multipart/form-data">
						<div class="col-sm-3">	
							<div class="form-group">
								<select class="selectpicker" style="width: 100%;"  name="cmd_cari" id="cmd_cari" >
									<option selected="selected" value="">---Pilih Kolom---</option>
									<option value="sect">SECTION</option>
									<option value="term">TERM</option>
									<option value="no_ctrl">CONTROL NO</option>
									<option value="lp">PURCHASING</option>
									<option value="id_proses">KODE PROSES</option>
									<option value="account">ACCOUNT</option>
									<option value="sub_acc">SUB ACCOUNT</option>
									<option value="part_no">PART NO</option>
									<option value="part_desc">PART NAME</option>
									<option value="part_dtl">DETAIL PART</option>
									<option value="periode">PERIODE</option>
									<option value="phase">PHASE</option>
									<option value="cv_code">Conveyor</option>
									<option value="qty">QTY</option>
									<option value="uom">UOM</option>
									<option value="price">PRICE</option>
									<option value="curr">CURRENCY</option>
									<option value="expaired">EXPAIRED DATE</option>
								</select>
							</div>
						</div>
						<div class="col-sm-4">	
							<div class="form-group">
								<div class="form-line">
									<input type="text"  class="form-control" data-role="tagsinput" id="txt_cari" name="txt_cari" placeholder="Detail Pencarian">
								</div> 
							</div>
						</div>

						<div class="col-sm-2">
							<button type="submit" name="cr_b" id="cr_b" class="btn bg-purple btn-circle-lg waves-effect waves-circle waves-float"><i class="material-icons">search</i> </button>
							<button type="reset" name="reset" id="reset" class="btn bg-red btn-circle-lg waves-effect waves-circle waves-float"><i class="material-icons">clear</i> </button>
						</div>
					</form>
				</div>	
			</div>	   
			<div class="row clearfix">
				<div class="body">
					<div class="table-responsive">
						<table id="example" class="table table-bordered table-striped table-hover dataTable js-exportable tabel2">
							<thead>
								<tr>	
									<th>SECTION</th>
									<th>TERM</th>
									<th>TYPE</th>
									<th>CONTROL NO</th>
									<th>PURCHASING</th>
									<th>PROCESS CODE</th>
									<th>ACCOUNT</th>
									<th>SUB ACC</th>
									<th>PART NO</th>
									<th>PART NAME</th>
									<th>PART DETAIL</th>
									<th>PERIODE</th>
									<th>QTY</th>
									<th>UOM</th>
									<th>CURR</th>
									<th>PRICE</th>
									<th>PHASE</th>
									<th>CC CODE</th>
									<th>EXPAIRED DATE</th>
									<th>QUOTATION</th>
									<th>PR</th>
									<th>PO</th>
									<th>ARRIVAL</th>
									<th>VP</th>
								</tr>
							</thead>

							<tbody>
								<?php
								if(isset($_POST['cr_b']) ){	

									$cmd_cari=$_POST['cmd_cari'];
									$txt_cari=str_replace(" ","",$_POST['txt_cari']);
									if($txt_cari==""){$whr=""; }else{
										$whr=" and replace($cmd_cari,' ','') like '%$txt_cari%'";
									}
									$sq_acc="select sect, term, jns_budget, no_ctrl, lp, id_proses, account, sub_acc, part_no, part_nm, part_dtl, periode, qty, uom, curr, price, phase,cccode,expaired,lt_Quo,lt_pr,lt_po,lt_datang,lt_vp from bps_budget where sect='$sect' $whr 
									UNION
									select sect, term, jns_budget, no_ctrl, lp, id_proses, account, sub_acc, part_no, part_nm, part_dtl, periode, qty, uom, curr, price, phase, cccode,expaired,lt_Quo,lt_pr,lt_po,lt_datang,lt_vp from bps_budget_add where sect='$sect' $whr and kode_chg in (4,5)";
									// echo $sq_acc;
								}

								if(isset($_POST['smpn'])  or isset($_POST['cr_b']))
								{
									$tb_acc=odbc_exec($koneksi_lp,$sq_acc);
									$row=0;$list_ctrl="";
									while($baris1=odbc_fetch_array($tb_acc))
									{ 
										$row++;
										$no_ctrl=odbc_result($tb_acc,"no_ctrl");
										$list_ctrl=$no_ctrl	.",".$list_ctrl;
										$expaired=odbc_result($tb_acc,"expaired");
										$lt_vp=Odbc_result($tb_acc,"lt_vp");
										$lt_datang=odbc_result($tb_acc,"lt_datang");
										$lt_po=odbc_result($tb_acc,"lt_po");
										$lt_pr=odbc_result($tb_acc,"lt_pr");
										$lt_Quo=odbc_result($tb_acc,"lt_Quo");
										$lt_datang_cumm=$lt_datang+$lt_vp;
										$lt_po_cumm=$lt_po+$lt_datang_cumm;
										$lt_pr_cumm=$lt_pr+$lt_po_cumm;
										$lt_Quo_cumm=$lt_Quo+$lt_pr_cumm;
										$view_lt_vp="($lt_vp) ".date('Y-m-d', strtotime($expaired. " - $lt_vp days"));
										$view_lt_datang="($lt_datang) ".date('Y-m-d', strtotime($expaired. " - $lt_datang_cumm days"));
										$view_lt_po="($lt_po) ".date('Y-m-d', strtotime($expaired. " - $lt_po_cumm days"));
										$view_lt_pr="($lt_pr) ".date('Y-m-d', strtotime($expaired. " - $lt_pr_cumm days"));
										$view_lt_Quo="($lt_Quo)) ".date('Y-m-d', strtotime($expaired. " - $lt_Quo_cumm days"));
										?>	
										<tr  onclick="javascript:pilih(this);">
											<td><?php echo odbc_result($tb_acc,"sect"); ?></td>
											<td><?php echo odbc_result($tb_acc,"term"); ?></td>
											<td><?php echo odbc_result($tb_acc,"jns_budget"); ?></td>
											<td><?php echo odbc_result($tb_acc,"no_ctrl"); ?></td>
											<td><?php echo odbc_result($tb_acc,"lp"); ?></td>
											<td><?php echo odbc_result($tb_acc,"id_proses"); ?></td>
											<td><?php echo odbc_result($tb_acc,"account"); ?></td>
											<td><?php echo odbc_result($tb_acc,"sub_acc"); ?></td>
											<td><?php echo odbc_result($tb_acc,"part_no"); ?></td>
											<td><?php echo odbc_result($tb_acc,"part_nm"); ?></td>
											<td><?php echo odbc_result($tb_acc,"part_dtl"); ?></td>
											<td><?php echo odbc_result($tb_acc,"periode"); ?></td>
											<td><?php echo odbc_result($tb_acc,"qty"); ?></td>
											<td><?php echo odbc_result($tb_acc,"uom"); ?></td>
											<td><?php echo odbc_result($tb_acc,"curr"); ?></td>
											<td><?php echo odbc_result($tb_acc,"price"); ?></td>
											<td><?php echo odbc_result($tb_acc,"phase"); ?></td>
											<td><?php echo odbc_result($tb_acc,"cccode"); ?></td>
											<td><?php echo date("Y-m-d",strtotime($expaired)); ?></td>
											<td><?php echo $lt_Quo; ?></td>
											<td><?php echo $lt_pr; ?></td>
											<td><?php echo $lt_po; ?></td>
											<td><?php echo $lt_datang; ?></td>
											<td><?php echo $lt_vp; ?></td>

										</tr>	
										<?php 
									}
								}
								?>	
							</tbody>
							<tfoot>
								<tr>

								</tr>
							</tfoot>
						</table>
					</div>
					<div class="body">
						<button type="button" class="btn bg-green waves-effect" onclick="open_child('Exp_xls/exp_budsect.php?&c=<?php echo $list_ctrl;?>','800','500'); return false;"><i class="material-icons">file_download</i>Download</button>
					</div>
				</div>					
			</div>            
		</div> 
	</div>           
</div>
</div>
</section>



<script type="text/javascript">
	$(document).ready(function()
	{
		$('.periode').bootstrapMaterialDatePicker({
			format: 'YYYYMM', minDate : new Date(),
			clearButton: true,
			weekStart: 1,
			time: false
		});	
	});

	function pilih(row){
		var kd_pel0=row.cells[0].innerHTML;
		var kd_pel1=row.cells[1].innerHTML;
		var kd_pel2=row.cells[2].innerHTML;
		var kd_pel3=row.cells[3].innerHTML;
		var kd_pel4=row.cells[4].innerHTML;
		var kd_pel5=row.cells[5].innerHTML;
		var kd_pel6=row.cells[6].innerHTML;
		var kd_pel7=row.cells[7].innerHTML;
		var kd_pel8=row.cells[8].innerHTML;
		var kd_pel9=row.cells[9].innerHTML;
		var kd_pel10=row.cells[10].innerHTML;
		var kd_pel11=row.cells[11].innerHTML;
		var kd_pel12=row.cells[12].innerHTML;
		var kd_pel13=row.cells[13].innerHTML;
		var kd_pel14=row.cells[14].innerHTML;
		var kd_pel15=row.cells[15].innerHTML;
		var kd_pel16=row.cells[16].innerHTML;
		var kd_pel17=row.cells[17].innerHTML;
		var kd_pel18=row.cells[18].innerHTML;
		var kd_pel19=row.cells[19].innerHTML;
		var kd_pel20=row.cells[20].innerHTML;
		var kd_pel21=row.cells[21].innerHTML;
		var kd_pel22=row.cells[22].innerHTML;
		var kd_pel23=row.cells[23].innerHTML;

		document.form1.term.value=kd_pel1;
		document.form1.jns_bud.value=kd_pel2;
		document.form1.no_ctrl.value=kd_pel3;
		document.form1.lp.value=kd_pel4;
		document.form1.id_proses.value=kd_pel5;
		document.form1.part_no.value=kd_pel8;
		document.form1.part_nm.value=kd_pel9;
		document.form1.part_dtl.value=kd_pel10;
		document.form1.periode.value=kd_pel11;
		document.form1.qty.value=kd_pel12;
		document.form1.uom.value=kd_pel13;
		document.form1.curr.value=kd_pel14;
		document.form1.price.value=kd_pel15;
		document.form1.phase.value=kd_pel16;
		document.form1.cccode.value=kd_pel17;
		document.form1.lt_Quo.value=kd_pel19;
		document.form1.lt_pr.value=kd_pel20;
		document.form1.lt_po.value=kd_pel21;
		document.form1.lt_datang.value=kd_pel22;
		document.form1.lt_vp.value=kd_pel23;

	}
</script>